<!DOCTYPE html>
<html>
<head>
<title>Отчет NoSQL.md</title>
<meta http-equiv="Content-type" content="text/html;charset=UTF-8">

<style>
/* https://github.com/microsoft/vscode/blob/master/extensions/markdown-language-features/media/markdown.css */
/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/

body {
	font-family: var(--vscode-markdown-font-family, -apple-system, BlinkMacSystemFont, "Segoe WPC", "Segoe UI", "Ubuntu", "Droid Sans", sans-serif);
	font-size: var(--vscode-markdown-font-size, 14px);
	padding: 0 26px;
	line-height: var(--vscode-markdown-line-height, 22px);
	word-wrap: break-word;
}

#code-csp-warning {
	position: fixed;
	top: 0;
	right: 0;
	color: white;
	margin: 16px;
	text-align: center;
	font-size: 12px;
	font-family: sans-serif;
	background-color:#444444;
	cursor: pointer;
	padding: 6px;
	box-shadow: 1px 1px 1px rgba(0,0,0,.25);
}

#code-csp-warning:hover {
	text-decoration: none;
	background-color:#007acc;
	box-shadow: 2px 2px 2px rgba(0,0,0,.25);
}

body.scrollBeyondLastLine {
	margin-bottom: calc(100vh - 22px);
}

body.showEditorSelection .code-line {
	position: relative;
}

body.showEditorSelection .code-active-line:before,
body.showEditorSelection .code-line:hover:before {
	content: "";
	display: block;
	position: absolute;
	top: 0;
	left: -12px;
	height: 100%;
}

body.showEditorSelection li.code-active-line:before,
body.showEditorSelection li.code-line:hover:before {
	left: -30px;
}

.vscode-light.showEditorSelection .code-active-line:before {
	border-left: 3px solid rgba(0, 0, 0, 0.15);
}

.vscode-light.showEditorSelection .code-line:hover:before {
	border-left: 3px solid rgba(0, 0, 0, 0.40);
}

.vscode-light.showEditorSelection .code-line .code-line:hover:before {
	border-left: none;
}

.vscode-dark.showEditorSelection .code-active-line:before {
	border-left: 3px solid rgba(255, 255, 255, 0.4);
}

.vscode-dark.showEditorSelection .code-line:hover:before {
	border-left: 3px solid rgba(255, 255, 255, 0.60);
}

.vscode-dark.showEditorSelection .code-line .code-line:hover:before {
	border-left: none;
}

.vscode-high-contrast.showEditorSelection .code-active-line:before {
	border-left: 3px solid rgba(255, 160, 0, 0.7);
}

.vscode-high-contrast.showEditorSelection .code-line:hover:before {
	border-left: 3px solid rgba(255, 160, 0, 1);
}

.vscode-high-contrast.showEditorSelection .code-line .code-line:hover:before {
	border-left: none;
}

img {
	max-width: 100%;
	max-height: 100%;
}

a {
	text-decoration: none;
}

a:hover {
	text-decoration: underline;
}

a:focus,
input:focus,
select:focus,
textarea:focus {
	outline: 1px solid -webkit-focus-ring-color;
	outline-offset: -1px;
}

hr {
	border: 0;
	height: 2px;
	border-bottom: 2px solid;
}

h1 {
	padding-bottom: 0.3em;
	line-height: 1.2;
	border-bottom-width: 1px;
	border-bottom-style: solid;
}

h1, h2, h3 {
	font-weight: normal;
}

table {
	border-collapse: collapse;
}

table > thead > tr > th {
	text-align: left;
	border-bottom: 1px solid;
}

table > thead > tr > th,
table > thead > tr > td,
table > tbody > tr > th,
table > tbody > tr > td {
	padding: 5px 10px;
}

table > tbody > tr + tr > td {
	border-top: 1px solid;
}

blockquote {
	margin: 0 7px 0 5px;
	padding: 0 16px 0 10px;
	border-left-width: 5px;
	border-left-style: solid;
}

code {
	font-family: Menlo, Monaco, Consolas, "Droid Sans Mono", "Courier New", monospace, "Droid Sans Fallback";
	font-size: 1em;
	line-height: 1.357em;
}

body.wordWrap pre {
	white-space: pre-wrap;
}

pre:not(.hljs),
pre.hljs code > div {
	padding: 16px;
	border-radius: 3px;
	overflow: auto;
}

pre code {
	color: var(--vscode-editor-foreground);
	tab-size: 4;
}

/** Theming */

.vscode-light pre {
	background-color: rgba(220, 220, 220, 0.4);
}

.vscode-dark pre {
	background-color: rgba(10, 10, 10, 0.4);
}

.vscode-high-contrast pre {
	background-color: rgb(0, 0, 0);
}

.vscode-high-contrast h1 {
	border-color: rgb(0, 0, 0);
}

.vscode-light table > thead > tr > th {
	border-color: rgba(0, 0, 0, 0.69);
}

.vscode-dark table > thead > tr > th {
	border-color: rgba(255, 255, 255, 0.69);
}

.vscode-light h1,
.vscode-light hr,
.vscode-light table > tbody > tr + tr > td {
	border-color: rgba(0, 0, 0, 0.18);
}

.vscode-dark h1,
.vscode-dark hr,
.vscode-dark table > tbody > tr + tr > td {
	border-color: rgba(255, 255, 255, 0.18);
}

</style>

<style>
/* Tomorrow Theme */
/* http://jmblog.github.com/color-themes-for-google-code-highlightjs */
/* Original theme - https://github.com/chriskempson/tomorrow-theme */

/* Tomorrow Comment */
.hljs-comment,
.hljs-quote {
	color: #8e908c;
}

/* Tomorrow Red */
.hljs-variable,
.hljs-template-variable,
.hljs-tag,
.hljs-name,
.hljs-selector-id,
.hljs-selector-class,
.hljs-regexp,
.hljs-deletion {
	color: #c82829;
}

/* Tomorrow Orange */
.hljs-number,
.hljs-built_in,
.hljs-builtin-name,
.hljs-literal,
.hljs-type,
.hljs-params,
.hljs-meta,
.hljs-link {
	color: #f5871f;
}

/* Tomorrow Yellow */
.hljs-attribute {
	color: #eab700;
}

/* Tomorrow Green */
.hljs-string,
.hljs-symbol,
.hljs-bullet,
.hljs-addition {
	color: #718c00;
}

/* Tomorrow Blue */
.hljs-title,
.hljs-section {
	color: #4271ae;
}

/* Tomorrow Purple */
.hljs-keyword,
.hljs-selector-tag {
	color: #8959a8;
}

.hljs {
	display: block;
	overflow-x: auto;
	color: #4d4d4c;
	padding: 0.5em;
}

.hljs-emphasis {
	font-style: italic;
}

.hljs-strong {
	font-weight: bold;
}
</style>

<style>
/*
 * Markdown PDF CSS
 */

 body {
	font-family: -apple-system, BlinkMacSystemFont, "Segoe WPC", "Segoe UI", "Ubuntu", "Droid Sans", sans-serif, "Meiryo";
	padding: 0 12px;
}

pre {
	background-color: #f8f8f8;
	border: 1px solid #cccccc;
	border-radius: 3px;
	overflow-x: auto;
	white-space: pre-wrap;
	overflow-wrap: break-word;
}

pre:not(.hljs) {
	padding: 23px;
	line-height: 19px;
}

blockquote {
	background: rgba(127, 127, 127, 0.1);
	border-color: rgba(0, 122, 204, 0.5);
}

.emoji {
	height: 1.4em;
}

code {
	font-size: 14px;
	line-height: 19px;
}

/* for inline code */
:not(pre):not(.hljs) > code {
	color: #C9AE75; /* Change the old color so it seems less like an error */
	font-size: inherit;
}

/* Page Break : use <div class="page"/> to insert page break
-------------------------------------------------------- */
.page {
	page-break-after: always;
}

</style>

<script src="https://unpkg.com/mermaid/dist/mermaid.min.js"></script>
</head>
<body>
  <script>
    mermaid.initialize({
      startOnLoad: true,
      theme: document.body.classList.contains('vscode-dark') || document.body.classList.contains('vscode-high-contrast')
          ? 'dark'
          : 'default'
    });
  </script>
<h1 id="%D0%B3%D0%BB%D0%B0%D0%B2%D0%B0-1-%D0%B0%D1%80%D1%85%D0%B8%D1%82%D0%B5%D0%BA%D1%82%D1%83%D1%80%D0%B0-%D0%B8-%D0%BE%D0%B1%D0%BE%D1%81%D0%BD%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D0%B5-%D1%81%D1%85%D0%B5%D0%BC%D1%8B">Глава 1 Архитектура и Обоснование Схемы</h1>
<h2 id="%D0%B2%D0%B2%D0%B5%D0%B4%D0%B5%D0%BD%D0%B8%D0%B5">Введение</h2>
<p>Настоящий отчет представляет собой документацию по проекту миграции и анализа данных образовательного учреждения (OU) с использованием нереляционной базы данных MongoDB и контейнеризации Docker.</p>
<p>Целью проекта являлось создание оптимизированной NoSQL-архитектуры на основе денормализации исходных реляционных таблиц, разработка надежного процесса ETL (Extract, Transform, Load) и демонстрация возможностей системы через выполнение десяти сложных аналитических запросов (MQL).</p>
<p>Полный исходный код проекта, включая скрипты инициализации и конфигурацию Docker Compose, доступен для проверки в публичном репозитории GitHub: https://github.com/luky048-ship-it/mongodb-architecture-university.git</p>
<h2 id="11-%D0%B2%D1%8B%D0%B1%D0%BE%D1%80-%D0%BC%D0%BE%D0%B4%D0%B5%D0%BB%D0%B8-nosql-mongodb">1.1 Выбор Модели: NoSQL (MongoDB)</h2>
<p>Мы выбрали нереляционную базу данных MongoDB для хранения данных об образовательном процессе (OU).</p>
<table>
<thead>
<tr>
<th>Причина выбора</th>
<th>Обоснование</th>
</tr>
</thead>
<tbody>
<tr>
<td>Неизменность данных</td>
<td>Данные курсов и оценок являются историческими и статичными, они редко меняются после миграции. Это идеально подходит для NoSQL, где структура оптимизирована для быстрого чтения.</td>
</tr>
<tr>
<td>Аналитическая нагрузка</td>
<td>Основная задача системы — выполнять сложные аналитические агрегации (расчет среднего балла, распределение по регионам). MongoDB с оператором $aggregate лучше справляется с этой задачей, чем традиционные SQL-соединения.</td>
</tr>
<tr>
<td>Горизонтальная масштабируемость</td>
<td>В долгосрочной перспективе NoSQL легче масштабируется при увеличении числа студентов и курсов.</td>
</tr>
</tbody>
</table>
<h2 id="12-%D0%B8%D0%BD%D1%84%D1%80%D0%B0%D1%81%D1%82%D1%80%D1%83%D0%BA%D1%82%D1%83%D1%80%D0%B0-%D0%B8-%D1%80%D0%B0%D0%B7%D0%B2%D0%B5%D1%80%D1%82%D1%8B%D0%B2%D0%B0%D0%BD%D0%B8%D0%B5-containerization">1.2 Инфраструктура и Развертывание (Containerization)</h2>
<p>Для обеспечения воспроизводимости и изоляции среды проекта была выбрана технология контейнеризации с использованием Docker и Docker Compose. Это позволяет упаковать базу данных MongoDB вместе со всей логикой инициализации и ETL-скриптами в единый, переносимый сервис.</p>
<table>
<thead>
<tr>
<th>Преимущество</th>
<th>Обоснование</th>
</tr>
</thead>
<tbody>
<tr>
<td>Воспроизводимость</td>
<td>Гарантируется, что среда разработки (версия MongoDB, конфигурация, переменные окружения) идентична среде развертывания.</td>
</tr>
<tr>
<td>Изоляция</td>
<td>&quot;Сервис MongoDB работает изолированно, не влияя на основную операционную систему и обеспечивая предсказуемое поведение.</td>
</tr>
<tr>
<td>Автоматизация Запуска</td>
<td>&quot;Файл docker-compose.yml содержит декларативное описание сервиса, включая персистентное хранилище (тома) и переменные окружения для аутентификации и конфигурации.</td>
</tr>
</tbody>
</table>
<h4 id="%D0%BA%D0%BE%D0%BD%D1%84%D0%B8%D0%B3%D1%83%D1%80%D0%B0%D1%86%D0%B8%D1%8F-%D1%81%D0%B5%D1%80%D0%B2%D0%B8%D1%81%D0%B0-mongodb">Конфигурация Сервиса MongoDB</h4>
<p>Основная конфигурация сервиса определена в файле docker-compose.yml, который связывает образ MongoDB с локальными скриптами инициализации и гарантирует сохранность данных:</p>
<pre class="hljs"><code><div>version: '3.8'
services:
  mongo:
    build:
      context: ./init-db
      dockerfile: Dockerfile
    image: university-mongo-custom:latest
    container_name: university-grades-mongo
    restart: unless-stopped
    ports:
      - &quot;27017:27017&quot;
    volumes:
      - mongo-data:/data/db
      - ./init-db:/docker-entrypoint-initdb.d:ro
    environment:
      MONGO_INITDB_DATABASE: university
      MONGO_INITDB_ROOT_USERNAME: root
      MONGO_INITDB_ROOT_PASSWORD: example
      OULAD_ZIP_URL: &quot;https://archive.ics.uci.edu/static/public/349/open+university+learning+analytics+dataset.zip&quot;
    healthcheck:
      test: [&quot;CMD&quot;, &quot;mongosh&quot;, &quot;--quiet&quot;, &quot;--eval&quot;, &quot;db.adminCommand('ping').ok&quot;]
      interval: 10s
      timeout: 10s
      retries: 10
      start_period: 30s
volumes:
  mongo-data:
    name: university-mongo-data
</div></code></pre>
<h2 id="14-%D0%B0%D0%B2%D1%82%D0%BE%D0%BC%D0%B0%D1%82%D0%B8%D0%B7%D0%B0%D1%86%D0%B8%D1%8F-%D0%B8-%D0%B7%D0%B0%D0%B3%D1%80%D1%83%D0%B7%D0%BA%D0%B0-%D0%B4%D0%B0%D0%BD%D0%BD%D1%8B%D1%85-extract--load">1.4 Автоматизация и Загрузка Данных (Extract &amp; Load)</h2>
<p><strong>Оркестрация Загрузки (Extract &amp; Load)</strong>
Ключевым аспектом реализации является полная автоматизация развертывания, при которой все этапы ETL выполняются последовательно в контейнере MongoDB. В этом проекте реализованна автоматическая загрузка базы данных: open_university_learning_analytics_dataset.</p>
<p>Загрузка сырых данных (mongoimport) является длительной и асинхронной операцией. Если трансформация начнется до ее завершения, она обработает неполные данные. Поэтому мы используем строгую алфавитно-цифровую последовательность скриптов, где 03-douwnload-and-import.sh выполняет Извлечение (Extract) и гарантирует завершение загрузки перед выходом. Скрипт 05-full-setup.sh выступает в роли Оркестратора, управляя логикой Трансформации с уверенностью, что все исходные данные уже доступны.</p>
<p>Данные подгружаются автоматически в фоновом процессе, что может занять длительное время.</p>
<h2 id="13-%D1%81%D1%85%D0%B5%D0%BC%D0%B0-%D0%B4%D0%B0%D0%BD%D0%BD%D1%8B%D1%85-%D0%B4%D0%B5%D0%BD%D0%BE%D1%80%D0%BC%D0%B0%D0%BB%D0%B8%D0%B7%D0%B0%D1%86%D0%B8%D1%8F">1.3. Схема Данных: Денормализация</h2>
<p>Вместо сохранения данных в семи отдельных таблицах, как в исходной реляционной структуре, мы использовали модель денормализации (Embedding).</p>
<p>Это означает, что связанные данные (например, информация о курсе и оценке) вложены в основной документ, что исключает необходимость частых операций соединения (JOIN) при выполнении аналитических запросов.</p>
<p>Мы создали три основные коллекции:</p>
<h4 id="1-students-%D1%81%D1%82%D1%83%D0%B4%D0%B5%D0%BD%D1%82%D1%8B">1. students (Студенты)</h4>
<p><strong>Назначение</strong>: Хранит основную информацию о студентах, историю обучения и финальный результат.</p>
<ul>
<li>
<p>Денормализация: Объединяет данные из таблиц studentInfo, studentRegistration и studentVle.</p>
</li>
<li>
<p>Ключевые поля: id_student, final_result, demographics (вложенный документ с образованием, регионом и возрастом).</p>
</li>
</ul>
<pre class="hljs"><code><div>STUDENTS [id_student, final_result]
├── id_student [Ключ: Уникальный] 
├── final_result (Pass, Fail, Distinction, Withdrawn)
├── demographics (Вложенный документ - studentInfo)
│   ├── region
│   ├── highest_education
│   └── age_band
└── study_history (Вложенный документ - studentRegistration)
    └── studied_credits
</div></code></pre>
<h4 id="2-grades-%D0%BE%D1%86%D0%B5%D0%BD%D0%BA%D0%B8">2. grades (Оценки)</h4>
<p><strong>Назначение</strong>: Хранит все сданные оценки студентами. Это самая крупная коллекция ($\approx 170\ 000$ документов).</p>
<ul>
<li>
<p>Денормализация: Содержит вложенные документы с информацией о курсе (course_info) и самой оценочной работе (assessment_info).</p>
</li>
<li>
<p>Ключевые поля: id_student, score, date_submitted.</p>
</li>
</ul>
<pre class="hljs"><code><div>GRADES [id_student, id_assessment, score]
├── id_student [Связь с STUDENTS, для $lookup]
├── score (Балл, -1 если нет)
├── date_submitted (Дата сдачи работы)
├── course_info (Вложенный документ - courses/studentRegistration)
│   ├── code_module
│   └── code_presentation
└── assessment_info (Вложенный документ - assessments)
    ├── type (TMA, CMA, Exam)
    ├── weight (Вес оценки)
    └── date_due (Крайний срок сдачи)
</div></code></pre>
<h4 id="3-courses-%D0%BA%D1%83%D1%80%D1%81%D1%8B">3. courses (Курсы)</h4>
<p><strong>Назначение</strong>: Хранит метаданные о курсах и связанных с ними оценочных работах.</p>
<ul>
<li>Денормализация: В документ курса (code_module, code_presentation) вложены все связанные оценочные работы (assessments) с их весами и сроками сдачи.</li>
</ul>
<pre class="hljs"><code><div>COURSES [code_module, code_presentation]
├── code_module
├── code_presentation
└── assessments [Массив вложенных документов - assessments]
    ├── assessment_info (Повторяется для каждой оценки курса)
    │   ├── id_assessment [Ключ: Уникальный в массиве]
    │   ├── assessment_type (TMA, CMA, Exam)
    │   ├── weight (Вес оценки в %)
    │   └── date (Дата сдачи)
</div></code></pre>
<h3 id="%D0%BA%D0%BB%D1%8E%D1%87%D0%B5%D0%B2%D1%8B%D0%B5-%D1%81%D0%B2%D1%8F%D0%B7%D0%B8-reference">Ключевые связи (Reference)</h3>
<p>Эта схема демонстрирует:</p>
<ul>
<li>
<p>Денормализацию (вложенные документы demographics, assessment_info).</p>
</li>
<li>
<p>Аналитическое ядро (grades).</p>
</li>
<li>
<p>Единственную оставшуюся связь (id_student) для расширенного анализа.</p>
</li>
</ul>
<h4 id="%D0%B5%D0%B4%D0%B8%D0%BD%D1%81%D1%82%D0%B2%D0%B5%D0%BD%D0%BD%D0%B0%D1%8F-%D0%B0%D0%BA%D1%82%D0%B8%D0%B2%D0%BD%D0%B0%D1%8F-%D1%81%D0%B2%D1%8F%D0%B7%D1%8C-reference">Единственная Активная Связь (Reference)</h4>
<p>В денормализованной схеме остается только одна ссылочная связь, которая не может быть устранена и требует использования $lookup:</p>
<pre class="hljs"><code><div>СТУДЕНТЫ [id_student]
  └── --- [ССЫЛКА (Reference) - Используется $lookup] ---&gt; GRADES [id_student]
</div></code></pre>
<h1 id="%D0%B3%D0%BB%D0%B0%D0%B2%D0%B0-2-%D0%BF%D1%80%D0%BE%D1%86%D0%B5%D1%81%D1%81-etl-%D0%BC%D0%B8%D0%B3%D1%80%D0%B0%D1%86%D0%B8%D1%8F-%D0%B4%D0%B0%D0%BD%D0%BD%D1%8B%D1%85">Глава 2 Процесс ETL (Миграция данных)</h1>
<h2 id="21-%D0%B8%D0%BD%D1%81%D1%82%D1%80%D1%83%D0%BC%D0%B5%D0%BD%D1%82%D0%B0%D1%80%D0%B8%D0%B9-%D0%B8-%D0%BE%D0%B1%D1%89%D0%B8%D0%B9-%D0%BF%D0%BE%D1%82%D0%BE%D0%BA">2.1. Инструментарий и Общий Поток</h2>
<p>Миграция была выполнена с использованием оркестрированной цепочки скриптов на Bash и JavaScript, активируемой автоматически механизмом Docker Entrypoint.</p>
<table>
<thead>
<tr>
<th>Этап ETL</th>
<th>Реализация</th>
<th>Описание</th>
</tr>
</thead>
<tbody>
<tr>
<td>Extract (Извлечение)</td>
<td>03-douwnload-and-import.sh</td>
<td>Данные из семи исходных CSV-файлов были извлечены и загружены в сырые коллекции (raw_*) MongoDB.</td>
</tr>
<tr>
<td>Orchestration</td>
<td>05-full-setup.sh</td>
<td>Главный контроллер, гарантирующий последовательный запуск трансформации и индексации только после завершения Extract.</td>
</tr>
<tr>
<td>Transform (Преобразование)</td>
<td>migrate.js и clean.js</td>
<td>Выполнялась основная работа по денормализации и очистке данных (дедупликация, обработка пропусков).</td>
</tr>
<tr>
<td>Load (Загрузка)</td>
<td>migrate.js</td>
<td>Преобразованные документы были загружены в три целевые коллекции: students, grades, и courses.</td>
</tr>
</tbody>
</table>
<h2 id="22-%D0%BE%D1%87%D0%B8%D1%81%D1%82%D0%BA%D0%B0-%D0%B8-%D0%BD%D0%BE%D1%80%D0%BC%D0%B0%D0%BB%D0%B8%D0%B7%D0%B0%D1%86%D0%B8%D1%8F-%D0%B4%D0%B0%D0%BD%D0%BD%D1%8B%D1%85">2.2. Очистка и Нормализация Данных</h2>
<p>Ключевым этапом ETL была обработка пропущенных значений и приведение данных к нужному типу:</p>
<table>
<thead>
<tr>
<th>Проблема</th>
<th>Решение в ETL-скрипте</th>
<th>Обоснование</th>
</tr>
</thead>
<tbody>
<tr>
<td>Пропущенные значения (?)</td>
<td>Все отсутствующие числовые значения в полях, таких как score (оценка) или date (дата сдачи), были заменены на числовой флаг -1.</td>
<td>Замена на -1 позволяет использовать числовые операторы MQL ($ne: -1, $gt, $avg) для фильтрации и аналитики без ошибок типов.</td>
</tr>
<tr>
<td>Денормализация</td>
<td>При создании документов в целевых коллекциях производилось вложение связанных данных.</td>
<td>Обеспечение максимальной скорости чтения для выполнения аналитических запросов без необходимости $lookup в большинстве случаев.</td>
</tr>
<tr>
<td>Удаление дубликатов</td>
<td>Скрипт clean.js использует конвейер агрегации для дедупликации коллекции students по полю id_student.</td>
<td>Гарантия целостности данных и уникальности записей, что является обязательным условием для создания уникального индекса и корректного использования в $lookup.</td>
</tr>
</tbody>
</table>
<p>Для реализации этой части были применен скрипт clean.js который гарантировал отсутствие дубликатов, а так же дополнительно в скрипте 04-schemas.js была применена JSON Schema Validation. Это обеспечило, что даже в случае внешнего воздействия, в целевые коллекции не будут записаны документы, нарушающие структуру (например, оценки score вне диапазона $[0, 100]$).</p>
<p><strong>Фрагмент кода из clean.js (Дедупликация):</strong></p>
<pre class="hljs"><code><div><span class="hljs-comment">// Используем Aggregation Pipeline для нахождения и удаления дубликатов.</span>
db.students.aggregate([
  {
    <span class="hljs-attr">$group</span>: {
      <span class="hljs-attr">_id</span>: <span class="hljs-string">"$id_student"</span>, <span class="hljs-comment">// Группируем по полю, которое должно быть уникальным</span>
      <span class="hljs-attr">duplicates</span>: { <span class="hljs-attr">$push</span>: <span class="hljs-string">"$_id"</span> }, <span class="hljs-comment">// Сохраняем все _id, принадлежащие этому id_student</span>
      <span class="hljs-attr">count</span>: { <span class="hljs-attr">$sum</span>: <span class="hljs-number">1</span> } <span class="hljs-comment">// Считаем количество документов</span>
    }
  },
  { <span class="hljs-attr">$match</span>: { <span class="hljs-attr">count</span>: { <span class="hljs-attr">$gt</span>: <span class="hljs-number">1</span> } } } <span class="hljs-comment">// Находим только те, где count &gt; 1 (дубликаты)</span>
]).forEach(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">doc</span>) </span>{
  <span class="hljs-comment">// Удаляем все документы, кроме первого (оставляем документ с наименьшим _id)</span>
  doc.duplicates.shift();
  db.students.deleteMany({ <span class="hljs-attr">_id</span>: { <span class="hljs-attr">$in</span>: doc.duplicates } });
});
</div></code></pre>
<h2 id="23-%D1%81%D1%82%D1%80%D1%83%D0%BA%D1%82%D1%83%D1%80%D0%B0-etl-%D1%81%D0%BA%D1%80%D0%B8%D0%BF%D1%82%D0%B0">2.3. Структура ETL-скрипта</h2>
<p>Скрипт migrate.js выполнил денормализацию, создавая следующие целевые структуры:</p>
<ul>
<li>
<p>Коллекция courses: Создание документов курсов и вложение в них всех связанных оценочных работ (assessments) для быстрого доступа к структуре курса.</p>
</li>
<li>
<p>Коллекция grades: Итерация по данным об оценках, вложение в каждый документ соответствующей информации о курсе (code_module, code_presentation) и оцениваемой работе (weight, type).</p>
</li>
<li>
<p>Коллекция students: Объединение информации о демографии, истории обучения и регистрации в один документ студента, формируя единую точку данных.</p>
</li>
</ul>
<p><strong>Фрагмент кода из migrate.js:</strong></p>
<pre class="hljs"><code><div>    <span class="hljs-comment">// ====================================================================</span>
    <span class="hljs-comment">// ШАГ 2: Миграция 'students'</span>
    <span class="hljs-comment">// ====================================================================</span>
    db.students.drop();
    print(<span class="hljs-string">"   -&gt; Очистка 'students' завершена."</span>);

    <span class="hljs-comment">// Используем Aggregation Framework для преобразования типов и денормализации</span>
    db.raw_studentInfo.aggregate([
        {
            <span class="hljs-attr">$project</span>: {
                <span class="hljs-attr">_id</span>: <span class="hljs-number">0</span>,
                <span class="hljs-comment">// Преобразование id_student в int</span>
                <span class="hljs-attr">id_student</span>: {
                  <span class="hljs-attr">$convert</span>: {
                      <span class="hljs-attr">input</span>: <span class="hljs-string">"$id_student"</span>,
                      <span class="hljs-attr">to</span>: <span class="hljs-string">"int"</span>,
                      <span class="hljs-attr">onError</span>: <span class="hljs-string">"$$REMOVE"</span>, <span class="hljs-comment">// Удалить документ, если ID невалидный</span>
                      <span class="hljs-attr">onNull</span>: <span class="hljs-string">"$$REMOVE"</span> 
                  }
              },
                <span class="hljs-attr">code_module</span>: <span class="hljs-string">"$code_module"</span>,
                <span class="hljs-attr">code_presentation</span>: <span class="hljs-string">"$code_presentation"</span>,
                <span class="hljs-attr">final_result</span>: <span class="hljs-string">"$final_result"</span>,
                <span class="hljs-comment">// Денормализация демографии в один вложенный объект</span>
                <span class="hljs-attr">demographics</span>: {
                    <span class="hljs-attr">gender</span>: <span class="hljs-string">"$gender"</span>,
                    <span class="hljs-attr">region</span>: <span class="hljs-string">"$region"</span>,
                    <span class="hljs-attr">age_band</span>: <span class="hljs-string">"$age_band"</span>,
                    <span class="hljs-attr">highest_education</span>: <span class="hljs-string">"$highest_education"</span>,
                    <span class="hljs-attr">disability</span>: <span class="hljs-string">"$disability"</span>
                },
                <span class="hljs-attr">study_history</span>: {
                    <span class="hljs-attr">num_of_prev_attempts</span>: {
                      <span class="hljs-attr">$convert</span>: {
                          <span class="hljs-attr">input</span>: <span class="hljs-string">"$num_of_prev_attempts"</span>,
                          <span class="hljs-attr">to</span>: <span class="hljs-string">"int"</span>,
                          <span class="hljs-attr">onError</span>: <span class="hljs-number">0</span>, 
                          <span class="hljs-attr">onNull</span>: <span class="hljs-number">0</span>
                      }
                  },
                    <span class="hljs-attr">studied_credits</span>: {
                      <span class="hljs-attr">$convert</span>: {
                          <span class="hljs-attr">input</span>: <span class="hljs-string">"$studied_credits"</span>,
                          <span class="hljs-attr">to</span>: <span class="hljs-string">"int"</span>,
                          <span class="hljs-attr">onError</span>: <span class="hljs-number">0</span>,   <span class="hljs-comment">// Если ошибка (например, '?'), ставим 0</span>
                          <span class="hljs-attr">onNull</span>: <span class="hljs-number">0</span>     <span class="hljs-comment">// Если поле отсутствует, ставим 0</span>
                        }
                    }
                }
            }
        },
   {
            <span class="hljs-attr">$out</span>: <span class="hljs-string">"students"</span>
        }
    ]);

    print(<span class="hljs-string">"Миграция 'students' (с денормализованной демографией) завершена."</span>);
}
</div></code></pre>
<h1 id="%D0%B3%D0%BB%D0%B0%D0%B2%D0%B0-3-%D0%B8%D0%BD%D0%B4%D0%B5%D0%BA%D1%81%D0%B0%D1%86%D0%B8%D1%8F-%D0%B8-%D0%BE%D0%BF%D1%82%D0%B8%D0%BC%D0%B8%D0%B7%D0%B0%D1%86%D0%B8%D1%8F">Глава 3 Индексация и Оптимизация</h1>
<h2 id="31-%D0%BD%D0%B5%D0%BE%D0%B1%D1%85%D0%BE%D0%B4%D0%B8%D0%BC%D0%BE%D1%81%D1%82%D1%8C-%D0%B8%D0%BD%D0%B4%D0%B5%D0%BA%D1%81%D0%B0%D1%86%D0%B8%D0%B8">3.1. Необходимость Индексации</h2>
<p>Сложные аналитические запросы, особенно те, которые используют агрегацию ($group), сортировку ($sort) или объединение ($lookup), работают крайне неэффективно без индексов. Без них MongoDB выполняет полное сканирование коллекции (Collection Scan), что приводит к зависанию на больших наборах данных.</p>
<h2 id="32-%D0%B0%D0%B2%D1%82%D0%BE%D0%BC%D0%B0%D1%82%D0%B8%D0%B7%D0%B0%D1%86%D0%B8%D1%8F-%D0%B8%D0%BD%D0%B4%D0%B5%D0%BA%D1%81%D0%B0%D1%86%D0%B8%D0%B8">3.2. Автоматизация Индексации</h2>
<p>Для обеспечения автоматизации и воспроизводимости проекта индексы создаются с помощью файла index.js, который автоматически выполняется при старте контейнера MongoDB в Docker.</p>
<p><strong>Фрагмент кода из index.js (Уникальный Индекс):</strong></p>
<pre class="hljs"><code><div><span class="hljs-comment">// ====================================================================</span>
<span class="hljs-comment">// 1. Индексы для коллекции 'students'</span>
<span class="hljs-comment">// ====================================================================</span>

db.students.createIndex(
    { <span class="hljs-string">"id_student"</span>: <span class="hljs-number">1</span> },
    { <span class="hljs-attr">unique</span>: <span class="hljs-literal">true</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">"idx_students_id"</span>, <span class="hljs-attr">background</span>: <span class="hljs-literal">true</span> }
);
print(<span class="hljs-string">"Индекс 'idx_students_id' (students, unique) создан."</span>);

db.students.createIndex(
    { <span class="hljs-string">"final_result"</span>: <span class="hljs-number">1</span>, <span class="hljs-string">"demographics.highest_education"</span>: <span class="hljs-number">1</span> },
    { <span class="hljs-attr">name</span>: <span class="hljs-string">"idx_result_education"</span>, <span class="hljs-attr">background</span>: <span class="hljs-literal">true</span> }
);
print(<span class="hljs-string">"Индекс 'idx_result_education' (students) создан."</span>);


<span class="hljs-comment">// ====================================================================</span>
<span class="hljs-comment">// 2. Индексы для коллекции 'grades'</span>
<span class="hljs-comment">// ====================================================================</span>

db.grades.createIndex(
    { <span class="hljs-string">"id_student"</span>: <span class="hljs-number">1</span> },
    { <span class="hljs-attr">name</span>: <span class="hljs-string">"idx_grades_student_id"</span>, <span class="hljs-attr">background</span>: <span class="hljs-literal">true</span> }
);
print(<span class="hljs-string">"Индекс 'idx_grades_student_id' (grades) создан."</span>);

db.grades.createIndex(
    {
        <span class="hljs-string">"course_info.code_module"</span>: <span class="hljs-number">1</span>,
        <span class="hljs-string">"assessment_info.type"</span>: <span class="hljs-number">1</span>,
        <span class="hljs-string">"score"</span>: <span class="hljs-number">-1</span>
    },
    { <span class="hljs-attr">name</span>: <span class="hljs-string">"idx_module_type_score"</span>, <span class="hljs-attr">background</span>: <span class="hljs-literal">true</span> }
);
print(<span class="hljs-string">"Индекс 'idx_module_type_score' (grades) создан."</span>);


<span class="hljs-comment">// ====================================================================</span>
<span class="hljs-comment">// 3. Индексы для коллекции 'courses'</span>
<span class="hljs-comment">// ====================================================================</span>

db.courses.createIndex(
    { <span class="hljs-string">"code_module"</span>: <span class="hljs-number">1</span>, <span class="hljs-string">"code_presentation"</span>: <span class="hljs-number">1</span> },
    { <span class="hljs-attr">unique</span>: <span class="hljs-literal">true</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">"idx_course_unique"</span>, <span class="hljs-attr">background</span>: <span class="hljs-literal">true</span> }
);
print(<span class="hljs-string">"Уникальный индекс 'idx_course_unique' (courses) создан."</span>);

</div></code></pre>
<h2 id="33-%D0%BA%D0%BB%D1%8E%D1%87%D0%B5%D0%B2%D1%8B%D0%B5-%D0%B8%D0%BD%D0%B4%D0%B5%D0%BA%D1%81%D1%8B-%D0%B8-%D0%BE%D0%B1%D0%BE%D1%81%D0%BD%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D0%B5">3.3. Ключевые Индексы и Обоснование</h2>
<p>Индексы были спроектированы как комбинированные, чтобы покрыть поля, используемые в стадиях $match и $sort ваших 10 аналитических запросов.</p>
<table>
<thead>
<tr>
<th>Коллекция</th>
<th>Индекс (MQL-ключ)</th>
<th>Назначение и Обоснование</th>
</tr>
</thead>
<tbody>
<tr>
<td>grades</td>
<td>{&quot;&quot;id_student&quot;&quot;: 1}</td>
<td>Критически важен для ускорения операций $lookup (Запрос №8) по локальному полю, а также для быстрого поиска оценок конкретного студента.</td>
</tr>
<tr>
<td>students</td>
<td>{&quot;&quot;id_student&quot;&quot;: 1, unique: true}</td>
<td>Критически важен для foreignField в операции $lookup (Запрос №8) и обеспечения уникальности идентификатора студента.</td>
</tr>
<tr>
<td>grades</td>
<td>{&quot;&quot;course_info.code_module&quot;&quot;: 1, &quot;&quot;assessment_info.type&quot;&quot;: 1, &quot;&quot;score&quot;&quot;: -1}</td>
<td>Оптимизация аналитических запросов (№1, №2), фильтрующих по курсу и типу работы, с последующей сортировкой по баллу.</td>
</tr>
<tr>
<td>students</td>
<td>{&quot;&quot;final_result&quot;&quot;: 1, &quot;&quot;demographics.highest_education&quot;&quot;: 1}</td>
<td>Оптимизация запросов по статусу завершения и демографии (Запрос №5), используя начальные фильтры для сужения набора данных.</td>
</tr>
</tbody>
</table>
<h1 id="%D0%B3%D0%BB%D0%B0%D0%B2%D0%B0-4-%D0%B0%D0%BD%D0%B0%D0%BB%D0%B8%D1%82%D0%B8%D1%87%D0%B5%D1%81%D0%BA%D0%B8%D0%B5-%D0%B7%D0%B0%D0%BF%D1%80%D0%BE%D1%81%D1%8B-%D0%BA-%D1%81%D1%83%D0%B1%D0%B4-mongodb">Глава 4 Аналитические запросы к СУБД MongoDB</h1>
<h3 id="%E2%84%96-1-%D1%82%D0%BE%D0%BF-5-%D1%81%D0%B0%D0%BC%D1%8B%D1%85-%D0%B0%D0%BA%D1%82%D0%B8%D0%B2%D0%BD%D1%8B%D1%85-%D0%BA%D1%83%D1%80%D1%81%D0%BE%D0%B2-%D0%BE%D0%BF%D1%80%D0%B5%D0%B4%D0%B5%D0%BB%D1%8F%D0%B5%D1%82-%D1%81%D0%B2%D1%8F%D0%B7%D0%BA%D0%B8-%22%D0%BC%D0%BE%D0%B4%D1%83%D0%BB%D1%8C-%D0%BF%D1%80%D0%B5%D0%B7%D0%B5%D0%BD%D1%82%D0%B0%D1%86%D0%B8%D1%8F%22-%D1%81-%D0%BD%D0%B0%D0%B8%D0%B1%D0%BE%D0%BB%D1%8C%D1%88%D0%B8%D0%BC-%D0%BA%D0%BE%D0%BB%D0%B8%D1%87%D0%B5%D1%81%D1%82%D0%B2%D0%BE%D0%BC-%D1%81%D0%B4%D0%B0%D0%BD%D0%BD%D1%8B%D1%85-%D0%B2%D0%B0%D0%BB%D0%B8%D0%B4%D0%BD%D1%8B%D1%85-%D0%BE%D1%86%D0%B5%D0%BD%D0%BE%D0%BA-%D1%87%D1%82%D0%BE-%D1%83%D0%BA%D0%B0%D0%B7%D1%8B%D0%B2%D0%B0%D0%B5%D1%82-%D0%BD%D0%B0-%D0%B2%D1%8B%D1%81%D0%BE%D0%BA%D1%83%D1%8E-%D0%B2%D0%BE%D0%B2%D0%BB%D0%B5%D1%87%D0%B5%D0%BD%D0%BD%D0%BE%D1%81%D1%82%D1%8C-%D0%B8%D0%BB%D0%B8-%D0%BF%D0%BE%D0%BF%D1%83%D0%BB%D1%8F%D1%80%D0%BD%D0%BE%D1%81%D1%82%D1%8C">№ 1  Топ-5 самых активных курсов. Определяет связки &quot;Модуль-Презентация&quot; с наибольшим количеством сданных валидных оценок, что указывает на высокую вовлеченность или популярность.</h3>
<pre class="hljs"><code><div>db.grades.aggregate([
 { <span class="hljs-attr">$match</span>: { <span class="hljs-attr">score</span>: { <span class="hljs-attr">$ne</span>: <span class="hljs-number">-1</span> } } },
 { <span class="hljs-attr">$group</span>: {
     <span class="hljs-attr">_id</span>: { <span class="hljs-attr">module</span>: <span class="hljs-string">"$course_info.code_module"</span>, <span class="hljs-attr">presentation</span>: <span class="hljs-string">"$course_info.code_presentation"</span> },
     <span class="hljs-attr">total_valid_grades</span>: { <span class="hljs-attr">$sum</span>: <span class="hljs-number">1</span> }
 }},
 { <span class="hljs-attr">$sort</span>: { <span class="hljs-attr">total_valid_grades</span>: <span class="hljs-number">-1</span> } },
 { <span class="hljs-attr">$limit</span>: <span class="hljs-number">5</span> }
]).pretty() 
</div></code></pre>
<p><img src="./screenshots/Топ 5 самых активных курсов.png" alt="ОШИБКА"></p>
<h3 id="%E2%84%96-2-%D1%81%D1%80%D0%B5%D0%B4%D0%BD%D0%B8%D0%B9-%D0%B1%D0%B0%D0%BB%D0%BB-%D0%BF%D0%BE-%D1%82%D0%B8%D0%BF%D1%83-%D1%80%D0%B0%D0%B1%D0%BE%D1%82%D1%8B-%D0%B2-%D0%BA%D1%83%D1%80%D1%81%D0%B5-aaa-%D0%BF%D0%BE%D0%B7%D0%B2%D0%BE%D0%BB%D1%8F%D0%B5%D1%82-%D1%81%D1%80%D0%B0%D0%B2%D0%BD%D0%B8%D1%82%D1%8C-%D0%BF%D0%BE-%D0%BA%D0%B0%D0%BA%D0%BE%D0%BC%D1%83-%D1%82%D0%B8%D0%BF%D1%83-%D0%BE%D1%86%D0%B5%D0%BD%D0%BE%D1%87%D0%BD%D1%8B%D1%85-%D1%80%D0%B0%D0%B1%D0%BE%D1%82-tma-cma-exam-%D1%81%D1%82%D1%83%D0%B4%D0%B5%D0%BD%D1%82%D1%8B-%D0%BA%D1%83%D1%80%D1%81%D0%B0-aaa-%D0%BF%D0%BE%D0%BA%D0%B0%D0%B7%D1%8B%D0%B2%D0%B0%D1%8E%D1%82-%D0%BB%D1%83%D1%87%D1%88%D0%B8%D0%B5-%D1%80%D0%B5%D0%B7%D1%83%D0%BB%D1%8C%D1%82%D0%B0%D1%82%D1%8B">№ 2 Средний балл по типу работы в курсе 'AAA'. Позволяет сравнить, по какому типу оценочных работ (TMA, CMA, Exam) студенты курса 'AAA' показывают лучшие результаты. |</h3>
<pre class="hljs"><code><div>db.grades.aggregate([
  { <span class="hljs-attr">$match</span>: { <span class="hljs-string">"course_info.code_module"</span>: <span class="hljs-string">"AAA"</span>, <span class="hljs-attr">score</span>: { <span class="hljs-attr">$ne</span>: <span class="hljs-number">-1</span> } } },
  { <span class="hljs-attr">$group</span>: { <span class="hljs-attr">_id</span>: <span class="hljs-string">"$assessment_info.type"</span>, <span class="hljs-attr">avg_score</span>: { <span class="hljs-attr">$avg</span>: <span class="hljs-string">"$score"</span> } } },
  { <span class="hljs-attr">$sort</span>: { <span class="hljs-attr">avg_score</span>: <span class="hljs-number">-1</span> } }
]).pretty()
</div></code></pre>
<p><img src="./screenshots/Средний балл по типу работы в курсе AAA.png" alt="ОШИБКА"></p>
<h3 id="%E2%84%96-3-%D1%80%D0%B0%D1%81%D0%BF%D1%80%D0%B5%D0%B4%D0%B5%D0%BB%D0%B5%D0%BD%D0%B8%D0%B5-%D0%BE%D1%86%D0%B5%D0%BD%D0%BE%D0%BA-%D0%BF%D0%BE-%D0%B4%D0%B8%D0%B0%D0%BF%D0%B0%D0%B7%D0%BE%D0%BD%D0%B0%D0%BC-%D0%B0%D0%BD%D0%B0%D0%BB%D0%B8%D0%B7%D0%B8%D1%80%D1%83%D0%B5%D1%82-%D0%BA%D0%B0%D1%87%D0%B5%D1%81%D1%82%D0%B2%D0%BE-%D0%BE%D0%B1%D1%83%D1%87%D0%B5%D0%BD%D0%B8%D1%8F-%D0%B3%D1%80%D1%83%D0%BF%D0%BF%D0%B8%D1%80%D1%83%D1%8F-%D0%B2%D1%81%D0%B5-%D0%B2%D0%B0%D0%BB%D0%B8%D0%B4%D0%BD%D1%8B%D0%B5-%D0%BE%D1%86%D0%B5%D0%BD%D0%BA%D0%B8-%D0%B2-%D0%B4%D0%B8%D0%B0%D0%BF%D0%B0%D0%B7%D0%BE%D0%BD%D1%8B-0-40-40-70-70-100">№ 3  Распределение оценок по диапазонам. Анализирует качество обучения, группируя все валидные оценки в диапазоны (0-40, 40-70, 70-100).</h3>
<pre class="hljs"><code><div>db.grades.aggregate([
  { <span class="hljs-attr">$match</span>: { <span class="hljs-attr">score</span>: { <span class="hljs-attr">$ne</span>: <span class="hljs-number">-1</span> } } },
  { <span class="hljs-attr">$bucket</span>: {
      <span class="hljs-attr">groupBy</span>: <span class="hljs-string">"$score"</span>,
      <span class="hljs-attr">boundaries</span>: [<span class="hljs-number">0</span>, <span class="hljs-number">40</span>, <span class="hljs-number">70</span>, <span class="hljs-number">100</span>],
      <span class="hljs-attr">default</span>: <span class="hljs-string">"Other"</span>,
      <span class="hljs-attr">output</span>: { <span class="hljs-attr">count</span>: { <span class="hljs-attr">$sum</span>: <span class="hljs-number">1</span> } }
  }}
]).pretty()
</div></code></pre>
<p><img src="./screenshots/Распределение оценок по диапозонам.png" alt="ОШИБКА"></p>
<h3 id="%E2%84%96-4-%D0%BE%D0%B1%D1%89%D0%B5%D0%B5-%D0%BA%D0%BE%D0%BB%D0%B8%D1%87%D0%B5%D1%81%D1%82%D0%B2%D0%BE-%D0%BE%D0%BF%D0%BE%D0%B7%D0%B4%D0%B0%D0%BD%D0%B8%D0%B9-%D0%BF%D0%BE%D0%B4%D1%81%D1%87%D0%B8%D1%82%D1%8B%D0%B2%D0%B0%D0%B5%D1%82-%D0%BE%D0%B1%D1%89%D0%B5%D0%B5-%D1%87%D0%B8%D1%81%D0%BB%D0%BE-%D0%B2%D1%81%D0%B5%D1%85-%D0%BE%D1%86%D0%B5%D0%BD%D0%BE%D0%BA-%D1%81%D0%B4%D0%B0%D0%BD%D0%BD%D1%8B%D1%85-%D0%BF%D0%BE%D1%81%D0%BB%D0%B5-%D0%BA%D1%80%D0%B0%D0%B9%D0%BD%D0%B5%D0%B3%D0%BE-%D1%81%D1%80%D0%BE%D0%BA%D0%B0-datesubmitted--datedue">№ 4  Общее количество опозданий. Подсчитывает общее число всех оценок, сданных после крайнего срока (date_submitted &gt; date_due).</h3>
<pre class="hljs"><code><div>db.grades.countDocuments({
  <span class="hljs-attr">$expr</span>: { <span class="hljs-attr">$gt</span>: [<span class="hljs-string">"$date_submitted"</span>, <span class="hljs-string">"$assessment_info.date_due"</span>] }
})
</div></code></pre>
<p><img src="./screenshots/Общее количество опозданий.png" alt="ОШИБКА"></p>
<h3 id="%E2%84%96-5-%D0%BF%D1%80%D0%BE%D1%86%D0%B5%D0%BD%D1%82-%D1%83%D1%81%D0%BF%D0%B5%D1%88%D0%BD%D0%BE%D0%B9-%D1%81%D0%B4%D0%B0%D1%87%D0%B8-%D0%BF%D0%BE-%D1%83%D1%80%D0%BE%D0%B2%D0%BD%D1%8E-%D0%BE%D0%B1%D1%80%D0%B0%D0%B7%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D1%8F-%D1%81%D1%80%D0%B0%D0%B2%D0%BD%D0%B8%D0%B2%D0%B0%D0%B5%D1%82-%D0%B4%D0%BE%D0%BB%D1%8E-%D1%81%D1%82%D1%83%D0%B4%D0%B5%D0%BD%D1%82%D0%BE%D0%B2-%D1%83%D1%81%D0%BF%D0%B5%D1%88%D0%BD%D0%BE-%D0%B7%D0%B0%D0%B2%D0%B5%D1%80%D1%88%D0%B8%D0%B2%D1%88%D0%B8%D1%85-%D0%BA%D1%83%D1%80%D1%81-passdistinction-%D0%B2-%D0%B7%D0%B0%D0%B2%D0%B8%D1%81%D0%B8%D0%BC%D0%BE%D1%81%D1%82%D0%B8-%D0%BE%D1%82-%D0%B8%D1%85-%D0%B2%D1%8B%D1%81%D1%88%D0%B5%D0%B3%D0%BE-%D0%BE%D0%B1%D1%80%D0%B0%D0%B7%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D1%8F">№ 5 Процент успешной сдачи по уровню образования. Сравнивает долю студентов, успешно завершивших курс (Pass/Distinction), в зависимости от их высшего образования.</h3>
<pre class="hljs"><code><div>db.students.aggregate([
  { <span class="hljs-attr">$group</span>: {
      <span class="hljs-attr">_id</span>: <span class="hljs-string">"$demographics.highest_education"</span>,
      <span class="hljs-attr">total</span>: { <span class="hljs-attr">$sum</span>: <span class="hljs-number">1</span> },
      <span class="hljs-attr">passed</span>: { <span class="hljs-attr">$sum</span>: { <span class="hljs-attr">$cond</span>: [ { <span class="hljs-attr">$in</span>: [<span class="hljs-string">"$final_result"</span>, [<span class="hljs-string">"Pass"</span>, <span class="hljs-string">"Distinction"</span>]] }, <span class="hljs-number">1</span>, <span class="hljs-number">0</span> ] } }
  }},
  { <span class="hljs-attr">$project</span>: {
      <span class="hljs-attr">_id</span>: <span class="hljs-string">"$_id"</span>,
      <span class="hljs-attr">pass_rate</span>: { <span class="hljs-attr">$multiply</span>: [ { <span class="hljs-attr">$divide</span>: [<span class="hljs-string">"$passed"</span>, <span class="hljs-string">"$total"</span>] }, <span class="hljs-number">100</span> ] }
  }},
  { <span class="hljs-attr">$sort</span>: { <span class="hljs-attr">pass_rate</span>: <span class="hljs-number">-1</span> } }
]).pretty()
</div></code></pre>
<p><img src="./screenshots/Процент успешной сдачи по уровню образования.png" alt="ОШИБКА"></p>
<h3 id="%E2%84%96-6-%D1%82%D0%BE%D0%BF-5-%D1%80%D0%B5%D0%B3%D0%B8%D0%BE%D0%BD%D0%BE%D0%B2-%D0%BF%D0%BE-%D0%B8%D0%B7%D1%83%D1%87%D0%B5%D0%BD%D0%BD%D1%8B%D0%BC-%D0%BA%D1%80%D0%B5%D0%B4%D0%B8%D1%82%D0%B0%D0%BC-%D0%B2%D1%8B%D1%8F%D0%B2%D0%BB%D1%8F%D0%B5%D1%82-%D1%80%D0%B5%D0%B3%D0%B8%D0%BE%D0%BD%D1%8B-%D0%B3%D0%B4%D0%B5-%D1%81%D1%82%D1%83%D0%B4%D0%B5%D0%BD%D1%82%D1%8B-%D0%B2-%D1%81%D1%80%D0%B5%D0%B4%D0%BD%D0%B5%D0%BC-%D0%B1%D0%B5%D1%80%D1%83%D1%82-%D0%BD%D0%B0-%D1%81%D0%B5%D0%B1%D1%8F-%D0%BD%D0%B0%D0%B8%D0%B1%D0%BE%D0%BB%D1%8C%D1%88%D1%83%D1%8E-%D1%83%D1%87%D0%B5%D0%B1%D0%BD%D1%83%D1%8E-%D0%BD%D0%B0%D0%B3%D1%80%D1%83%D0%B7%D0%BA%D1%83">№ 6 Топ-5 регионов по изученным кредитам. Выявляет регионы, где студенты в среднем берут на себя наибольшую учебную нагрузку.</h3>
<pre class="hljs"><code><div>db.students.aggregate([
  { <span class="hljs-attr">$group</span>: { <span class="hljs-attr">_id</span>: <span class="hljs-string">"$demographics.region"</span>, <span class="hljs-attr">avg_credits</span>: { <span class="hljs-attr">$avg</span>: <span class="hljs-string">"$study_history.studied_credits"</span> } } },
  { <span class="hljs-attr">$sort</span>: { <span class="hljs-attr">avg_credits</span>: <span class="hljs-number">-1</span> } },
  { <span class="hljs-attr">$limit</span>: <span class="hljs-number">5</span> }
]).pretty()
</div></code></pre>
<p><img src="./screenshots/Топ-5 регионов по изученным кредитам.png" alt="ОШИБКА"></p>
<h3 id="%E2%84%96-7-%D1%81%D0%B0%D0%BC%D0%B0%D1%8F-%D1%80%D0%B0%D1%81%D0%BF%D1%80%D0%BE%D1%81%D1%82%D1%80%D0%B0%D0%BD%D0%B5%D0%BD%D0%BD%D0%B0%D1%8F-%D0%B2%D0%BE%D0%B7%D1%80%D0%B0%D1%81%D1%82%D0%BD%D0%B0%D1%8F-%D0%B3%D1%80%D1%83%D0%BF%D0%BF%D0%B0-%D1%81%D1%80%D0%B5%D0%B4%D0%B8-%22%D0%BE%D1%82%D0%BA%D0%B0%D0%B7%D0%BD%D0%B8%D0%BA%D0%BE%D0%B2%22-%D0%BE%D0%BF%D1%80%D0%B5%D0%B4%D0%B5%D0%BB%D1%8F%D0%B5%D1%82-%D0%B2%D0%BE%D0%B7%D1%80%D0%B0%D1%81%D1%82%D0%BD%D1%83%D1%8E-%D0%B3%D1%80%D1%83%D0%BF%D0%BF%D1%83-%D0%BA%D0%BE%D1%82%D0%BE%D1%80%D0%B0%D1%8F-%D1%87%D0%B0%D1%89%D0%B5-%D0%B2%D1%81%D0%B5%D0%B3%D0%BE-%D0%B1%D1%80%D0%BE%D1%81%D0%B0%D0%B5%D1%82-%D0%BE%D0%B1%D1%83%D1%87%D0%B5%D0%BD%D0%B8%D0%B5-withdrawn">№ 7 Самая распространенная возрастная группа среди &quot;отказников&quot;. Определяет возрастную группу, которая чаще всего бросает обучение (Withdrawn).</h3>
<pre class="hljs"><code><div>db.students.aggregate([
  { <span class="hljs-attr">$match</span>: { <span class="hljs-attr">final_result</span>: <span class="hljs-string">"Withdrawn"</span> } },
  { <span class="hljs-attr">$group</span>: { <span class="hljs-attr">_id</span>: <span class="hljs-string">"$demographics.age_band"</span>, <span class="hljs-attr">count</span>: { <span class="hljs-attr">$sum</span>: <span class="hljs-number">1</span> } } },
  { <span class="hljs-attr">$sort</span>: { <span class="hljs-attr">count</span>: <span class="hljs-number">-1</span> } },
  { <span class="hljs-attr">$limit</span>: <span class="hljs-number">1</span> }
]).pretty()
</div></code></pre>
<p><img src="./screenshots/Самая распространенная возврастная группа.png" alt="ОШИБКА"></p>
<h3 id="%E2%84%96-8-%D1%81%D1%80%D0%B5%D0%B4%D0%BD%D0%B8%D0%B9-%D0%B1%D0%B0%D0%BB%D0%BB-%D0%BF%D0%BE-%D0%BF%D0%BE%D0%BB%D1%83-%D1%81%D1%82%D1%83%D0%B4%D0%B5%D0%BD%D1%82%D0%BE%D0%B2-%D1%82%D1%80%D0%B5%D0%B1%D1%83%D0%B5%D1%82-%D0%BE%D0%B1%D1%8A%D0%B5%D0%B4%D0%B8%D0%BD%D0%B5%D0%BD%D0%B8%D1%8F-lookup-%D0%BA%D0%BE%D0%BB%D0%BB%D0%B5%D0%BA%D1%86%D0%B8%D0%B9-grades-%D0%B8-students-%D0%B4%D0%BB%D1%8F-%D1%80%D0%B0%D1%81%D1%87%D0%B5%D1%82%D0%B0-%D1%81%D1%80%D0%B5%D0%B4%D0%BD%D0%B5%D0%B3%D0%BE-%D0%B1%D0%B0%D0%BB%D0%BB%D0%B0">№ 8 Средний балл по полу студентов. Требует объединения ($lookup) коллекций grades и students для расчета среднего балла.</h3>
<pre class="hljs"><code><div>db.grades.aggregate([
  { <span class="hljs-attr">$match</span>: { <span class="hljs-attr">score</span>: { <span class="hljs-attr">$ne</span>: <span class="hljs-number">-1</span> } } },
  { <span class="hljs-attr">$lookup</span>: {
      <span class="hljs-attr">from</span>: <span class="hljs-string">"students"</span>,
      <span class="hljs-attr">localField</span>: <span class="hljs-string">"id_student"</span>,
      <span class="hljs-attr">foreignField</span>: <span class="hljs-string">"id_student"</span>,
      <span class="hljs-attr">as</span>: <span class="hljs-string">"s"</span>
  }},
  { <span class="hljs-attr">$unwind</span>: <span class="hljs-string">"$s"</span> },
  { <span class="hljs-attr">$group</span>: { <span class="hljs-attr">_id</span>: <span class="hljs-string">"$s.demographics.gender"</span>, <span class="hljs-attr">avg_score</span>: { <span class="hljs-attr">$avg</span>: <span class="hljs-string">"$score"</span> } } },
  { <span class="hljs-attr">$sort</span>: { <span class="hljs-attr">avg_score</span>: <span class="hljs-number">-1</span> } }
]).pretty()
</div></code></pre>
<p><img src="./screenshots/Средний балл по полу студентов.png" alt="ОШИБКА"></p>
<h3 id="%E2%84%96-9-%D0%BA%D1%83%D1%80%D1%81%D1%8B-%D1%81-%D0%BE%D0%B1%D1%8F%D0%B7%D0%B0%D1%82%D0%B5%D0%BB%D1%8C%D0%BD%D1%8B%D0%BC-%D1%8D%D0%BA%D0%B7%D0%B0%D0%BC%D0%B5%D0%BD%D0%BE%D0%BC-%D0%B2%D0%B5%D1%81-100-%D0%B2%D1%8B%D1%8F%D0%B2%D0%BB%D1%8F%D0%B5%D1%82-%D0%BC%D0%BE%D0%B4%D1%83%D0%BB%D0%B8-%D0%B3%D0%B4%D0%B5-%D0%BE%D0%B4%D0%B8%D0%BD-%D1%8D%D0%BA%D0%B7%D0%B0%D0%BC%D0%B5%D0%BD-%D1%80%D0%B5%D1%88%D0%B0%D0%B5%D1%82-%D0%B2%D0%B5%D1%81%D1%8C-%D1%80%D0%B5%D0%B7%D1%83%D0%BB%D1%8C%D1%82%D0%B0%D1%82">№ 9 Курсы с обязательным экзаменом (вес 100%). Выявляет модули, где один экзамен решает весь результат.</h3>
<pre class="hljs"><code><div>db.courses.aggregate([
  { <span class="hljs-attr">$unwind</span>: <span class="hljs-string">"$assessments"</span> },
  { <span class="hljs-attr">$match</span>: { <span class="hljs-string">"assessments.weight"</span>: <span class="hljs-number">100.0</span> } },
  { <span class="hljs-attr">$group</span>: { <span class="hljs-attr">_id</span>: <span class="hljs-string">"$code_module"</span>, <span class="hljs-attr">count</span>: { <span class="hljs-attr">$sum</span>: <span class="hljs-number">1</span> } } },
  { <span class="hljs-attr">$sort</span>: { <span class="hljs-attr">count</span>: <span class="hljs-number">-1</span> } }
]).pretty()
</div></code></pre>
<p><img src="./screenshots/Курсы с обязательным экзаменом.png" alt="ОШИБКА"></p>
<h3 id="%E2%84%96-10-%D1%81%D1%80%D0%B5%D0%B4%D0%BD%D0%B8%D0%B9-%D0%B2%D0%B5%D1%81-%D0%BE%D1%86%D0%B5%D0%BD%D0%BE%D1%87%D0%BD%D1%8B%D1%85-%D1%80%D0%B0%D0%B1%D0%BE%D1%82-%D0%BF%D0%BE-%D0%BC%D0%BE%D0%B4%D1%83%D0%BB%D1%8E-%D0%BF%D0%BE%D0%B7%D0%B2%D0%BE%D0%BB%D1%8F%D0%B5%D1%82-%D1%81%D1%80%D0%B0%D0%B2%D0%BD%D0%B8%D1%82%D1%8C-%D1%81%D1%80%D0%B5%D0%B4%D0%BD%D1%8E%D1%8E-%22%D1%81%D1%82%D0%BE%D0%B8%D0%BC%D0%BE%D1%81%D1%82%D1%8C%22-%D0%BE%D0%B4%D0%BD%D0%BE%D0%B9-%D1%80%D0%B0%D0%B1%D0%BE%D1%82%D1%8B-%D0%BF%D0%BE-%D0%BC%D0%BE%D0%B4%D1%83%D0%BB%D1%8F%D0%BC">№ 10 Средний вес оценочных работ по модулю. Позволяет сравнить среднюю &quot;стоимость&quot; одной работы по модулям.</h3>
<pre class="hljs"><code><div>db.courses.aggregate([
  { <span class="hljs-attr">$unwind</span>: <span class="hljs-string">"$assessments"</span> },
  { <span class="hljs-attr">$group</span>: { <span class="hljs-attr">_id</span>: <span class="hljs-string">"$code_module"</span>, <span class="hljs-attr">avg_weight</span>: { <span class="hljs-attr">$avg</span>: <span class="hljs-string">"$assessments.weight"</span> } } },
  { <span class="hljs-attr">$sort</span>: { <span class="hljs-attr">avg_weight</span>: <span class="hljs-number">-1</span> } }
]).pretty()
</div></code></pre>
<p><img src="./screenshots/Средний вес оценочных работ по модулю.png" alt="ОШИБКА"></p>
<h1 id="%D0%B7%D0%B0%D0%BA%D0%BB%D1%8E%D1%87%D0%B5%D0%BD%D0%B8%D0%B5">Заключение</h1>
<p>Все поставленные задачи проекта были успешно выполнены. Была создана масштабируемая и производительная архитектура MongoDB, основанная на денормализации данных, что позволило минимизировать операции соединения и обеспечить высокую скорость чтения. Процесс ETL был успешно реализован. Создание всех необходимых индексов решило критические проблемы производительности для сложных агрегаций. В результате, система продемонстрировала способность к быстрому выполнению всех десяти аналитических запросов, что подтверждает эффективность выбранного NoSQL-решения.</p>

</body>
</html>
